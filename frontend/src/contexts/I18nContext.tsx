import React, { createContext, useContext, useEffect, useMemo, useState } from 'react';

type Lang = 'en' | 'ar';

const translations: Record<Lang, Record<string, string>> = {
  en: {
    // User Management
    'users.title': 'Users Management',
    'users.subtitle': 'Manage system users and permissions',
    'users.list.title': 'System Users',
    'users.add': 'Add User',
    'users.addUser': 'Add New User',
    'users.active': 'Active',
    'users.inactive': 'Inactive',
    'users.deactivate': 'Deactivate',
    'users.activate': 'Activate',
    'users.noUsersFound': 'No Users Found',
    'users.noUsersFoundDescription': 'No users found matching your criteria. Try adjusting the filters or add a new user.',
    'users.list.subtitle': 'View and manage all system users',
    'users.list.totalUsers': 'Total Users',
    'users.filters.role': 'Role',
    'users.filters.allRoles': 'All Roles',
    'users.filters.department': 'Department',
    'users.filters.allDepartments': 'All Departments',
    'users.filters.status': 'Status',
    'users.filters.allStatus': 'All Status',
    'users.filters.active': 'Active',
    'users.filters.inactive': 'Inactive',
    'users.table.name': 'Name',
    'users.table.username': 'Username',
    'users.table.email': 'Email',
    'users.table.role': 'Role',
    'users.table.department': 'Department',
    'users.table.status': 'Status',
    'users.table.actions': 'Actions',
    'users.roles.companyManager': 'Company Manager',
    'users.roles.deputyManager': 'Deputy Manager',
    'users.roles.departmentManager': 'Department Manager',
    'users.roles.sectionSupervisor': 'Section Supervisor',
    'users.roles.technician': 'Technician',
    'users.roles.warehouseKeeper': 'Warehouse Keeper',
    'users.loading': 'Loading users...',
    'users.empty': 'No users found',
    'users.editUser': 'Edit User',
    'users.userInformation': 'User Information',
    'users.firstName': 'First Name',
    'users.lastName': 'Last Name',
    'users.email': 'Email',
    'users.phone': 'Phone',
    'users.role': 'Role',
    'users.department': 'Department',
    'users.selectDepartment': 'Select Department',
    // Requests
    'requests.title': 'Service Requests',
    'requests.subtitle': 'Manage and track all service requests',
    'requests.new': 'New Request',
    'requests.section.allRequests': 'All Requests',
    'requests.section.filters': 'Search and filter service requests',
    'requests.search.label': 'Search requests',
    'requests.search.placeholder': 'Search by request number, customer name, or issue description...',
    'requests.search.resetHint': 'Press Escape to reset filters or clear the text',
    'requests.filters.status': 'Status',
    'requests.filters.status.all': 'All statuses',
    'requests.filters.priority': 'Priority',
    'requests.filters.priority.all': 'All priorities',
    'requests.filters.warranty': 'Warranty Status',
    'requests.filters.warranty.all': 'All warranty statuses',
    'requests.filters.department': 'Department',
    'requests.filters.department.all': 'All departments',
    'requests.filters.technician': 'Assigned Technician',
    'requests.filters.technician.all': 'All technicians',
    'requests.filters.limit': 'Show',
    'requests.filters.limit.option': '{count} requests',
    'requests.filters.overdueOnly': 'Overdue requests only',
    'requests.summary.total': '{count} total requests',
    'requests.summary.overdue': '{count} overdue',
    'requests.summary.separator': '•',
    'requests.overdue.badge': 'Overdue',
    'requests.table.number': 'Request Number',
    'requests.table.customer': 'Customer',
    'requests.table.department': 'Department',
    'requests.table.technician': 'Technician',
    'requests.table.status': 'Status',
    'requests.table.priority': 'Priority',
    'requests.table.created': 'Created Date',
    'requests.table.view': 'View',
    'requests.empty': 'No requests found',
    'requests.loading': 'Loading...',
    'create.title': 'Create New Request',
    'create.subtitle': 'Create a new service request for a customer',
    'create.cardTitle': 'Request Information',
    'create.cardSubtitle': 'Please fill in all required fields',
    'create.customer': 'Customer',
    'create.customerPlaceholder': 'Select a customer...',
    'create.product': 'Product (optional)',
    'create.productPlaceholder': 'Select a product (optional)...',
    'create.executionMethod': 'Execution Method',
    'create.executionOnsite': 'On-site visit',
    'create.executionWorkshop': 'Workshop',
    'create.warrantyStatus': 'Warranty Status',
    'create.warrantyUnder': 'Under warranty',
    'create.warrantyOut': 'Out of warranty',
    'create.priority': 'Priority',
    'create.priorityLow': 'Low',
    'create.priorityNormal': 'Normal',
    'create.priorityHigh': 'High',
    'create.priorityUrgent': 'Urgent',
    'create.purchaseDate': 'Purchase Date (optional)',
    'create.purchaseDateHelp': 'Product purchase date (optional)',
    'create.issue': 'Issue Description',
    'create.issue.placeholder': 'Describe the issue...',
    'create.issueHelp': 'Provide detailed information about the issue or required service',
    'create.submit': 'Create Request',
    'create.cancel': 'Cancel',
    'create.creating': 'Creating...',
    'details.title': 'Request Details',
    'details.subtitle': 'View and manage request details',
    'details.back': 'Back',
    'details.overview': 'Overview',
    'details.number': 'Number',
    'details.status': 'Status',
    'details.customer': 'Customer',
    'details.department': 'Department',
    'details.technician': 'Technician',
    'details.priority': 'Priority',
    'details.issue': 'Issue',
    'details.activities': 'Activities',
    'details.activities.empty': 'No activities yet.',
    'details.costs': 'Costs',
    'details.costs.add': 'Add',
    'details.assign': 'Assign Technician',
    'details.updateStatus': 'Update Status',
    'details.close': 'Close Request',
    'details.finalNotes': 'Final notes',
    'details.satisfaction': 'Customer satisfaction (1-5)',
    'pagination.prev': 'Previous',
    'pagination.next': 'Next',
    'pagination.pageOf': 'Page {page} of {totalPages} • {total} total',
    // Navigation
    'nav.dashboard': 'Dashboard',
    'nav.requests': 'Requests',
    'nav.customers': 'Clients',
    'nav.products': 'Products',
    'nav.storage': 'Storage',
    'nav.warehouse': 'Warehouse',
    'nav.users': 'Agents',
    'nav.accounts': 'Accounts',
    'nav.statusManagement': 'Status Management',
    'status.title': 'Status Management',
    'status.subtitle': 'Manage custom request statuses',
    'status.add': 'Add Status',
    'status.edit': 'Edit Status',
    'status.delete': 'Delete Status',
    'status.name': 'Status Name',
    'status.displayName': 'Display Name',
    'status.description': 'Description',
    'status.color': 'Color',
    'status.isActive': 'Active',
    'status.sortOrder': 'Sort Order',
    'status.createdBy': 'Created By',
    'status.createdAt': 'Created At',
    'status.actions': 'Actions',
    'status.noStatuses': 'No statuses found',
    'status.confirmDelete': 'Are you sure you want to delete this status?',
    'status.success.created': 'Status created successfully',
    'status.success.updated': 'Status updated successfully',
    'status.success.deleted': 'Status deleted successfully',
    'status.error.load': 'Failed to load statuses',
    'status.error.create': 'Failed to create status',
    'status.error.update': 'Failed to update status',
    'status.error.delete': 'Failed to delete status',
    'nav.reports': 'Reports',
    'dashboard.stats.totalRequests': 'Total Requests',
    'dashboard.stats.overdueRequests': 'Overdue Requests',
    'dashboard.stats.completedRequests': 'Completed',
    'dashboard.stats.pendingRequests': 'Pending Requests',
    'dashboard.stats.underWarranty': 'Under Warranty',
    'dashboard.stats.outOfWarranty': 'Out of Warranty',
    'dashboard.welcome': 'Welcome, {firstName}!',
    'dashboard.welcomeSubtitle': 'Here\'s what\'s happening with maintenance requests today.',
    'dashboard.overdueAlert': 'Alert: You have {count} overdue request(s)',
    'dashboard.overdueDescription': 'The following requests have exceeded the deadline and need immediate attention:',
    'dashboard.daysOverdue': 'days overdue',
    'dashboard.viewAllOverdue': 'View all overdue requests ({count})',
    'dashboard.recentRequests': 'Recent Requests',
    'dashboard.recentRequestsDesc': 'Latest maintenance requests in the system',
    'dashboard.loading': 'Loading...',
    'dashboard.noRequests': 'No requests found',
    'dashboard.showingRequests': 'Showing {count} of {total} requests',
    'dashboard.viewAllRequests': 'View all requests →',
    'dashboard.quickActions.newRequest': 'New Request',
    'dashboard.quickActions.newRequestDesc': 'Create a new maintenance request',
    'dashboard.quickActions.clients': 'Clients',
    'dashboard.quickActions.clientsDesc': 'View and manage clients',
    'dashboard.quickActions.reports': 'Reports',
    'dashboard.quickActions.reportsDesc': 'View analytics and reports',
    'dashboard.quickActions.profile': 'Profile',
    'dashboard.quickActions.profileDesc': 'Update profile settings',
    'dashboard.table.number': 'Request Number',
    'dashboard.table.client': 'Client',
    'dashboard.table.product': 'Product',
    'dashboard.table.status': 'Status',
    'dashboard.table.priority': 'Priority',
    'dashboard.table.created': 'Created Date',
    'dashboard.undefined': 'Not specified',
    // Customers
    'customers.title': 'Clients',
    'customers.subtitle': 'Manage client information',
    'customers.add': 'Add Client',
    'customers.name': 'Name',
    'customers.phone': 'Phone',
    'customers.email': 'Email',
    'customers.city': 'City',
    'customers.address': 'Address',
    'customers.loading': 'Loading customers...',
    'customers.empty': 'No customers found',
    'customers.save': 'Save',
    'customers.cancel': 'Cancel',
    // Products
    'products.title': 'Products',
    'products.subtitle': 'Manage product catalog',
    'products.add': 'Add Product',
    'products.name': 'Name',
    'products.model': 'Model',
    'products.serial': 'Serial Number',
    'products.category': 'Category',
    'products.department': 'Department',
    'products.warranty': 'Warranty (months)',
    'products.loading': 'Loading products...',
    'products.empty': 'No products found',
    'products.save': 'Save',
    'products.cancel': 'Cancel',
    'products.readOnlyAccess': 'You have read-only access to products',
    // Storage
    'storage.title': 'Storage Management',
    'storage.subtitle': 'Manage spare parts and inventory',
    // Warehouse
    'warehouse.title': 'Warehouse',
    'warehouse.subtitle': 'Manage spare parts and requests',
    'warehouse.onlyKeeper': 'Only Warehouse Keeper can modify parts',
    'storage.add': 'Add Spare Part',
    'storage.name': 'Part Name',
    'storage.partNumber': 'Part Number',
    'storage.presentPieces': 'Number of Present Pieces',
    'storage.category': 'Category',
    'storage.currency': 'Currency',
    'storage.quantity': 'Quantity',
    'storage.minQuantity': 'Min Quantity',
    'storage.unitPrice': 'Unit Price',
    'storage.supplier': 'Supplier',
    'storage.location': 'Location',
    'storage.description': 'Description',
    'storage.loading': 'Loading spare parts...',
    'storage.empty': 'No spare parts found',
    'storage.save': 'Save',
    'storage.cancel': 'Cancel',
    'storage.edit': 'Edit',
    'storage.delete': 'Delete',
    'storage.update': 'Update',
    'storage.addToRequest': 'Add to Request',
    'storage.quantityUsed': 'Quantity Used',
    'storage.totalCost': 'Total Cost',
    'storage.inStock': 'In Stock',
    'storage.lowStock': 'Low Stock',
    'storage.outOfStock': 'Out of Stock',
    'storage.stockStatus': 'Stock Status',
    'storage.lastUpdated': 'Last Updated',
    'storage.actions': 'Actions',
    'storage.confirmDelete': 'Are you sure you want to delete this spare part?',
    'storage.deleteSuccess': 'Spare part deleted successfully',
    'storage.createSuccess': 'Spare part created successfully',
    'storage.updateSuccess': 'Spare part updated successfully',
    'storage.addToRequestSuccess': 'Spare part added to request successfully',
    'storage.history': 'History',
    'storage.changeHistory': 'Change History',
    'storage.changeReason': 'Change Reason (Required)',
    'storage.changeReasonPlaceholder': 'Please specify the reason for the change (e.g., price update due to supplier change, quantity correction after inventory...)',
    'storage.changeReasonHelp': 'This reason will be saved in the changes for administrators to see',
    'storage.loadingHistory': 'Loading...',
    'storage.noChanges': 'No changes',
    'storage.noChangesYet': 'No changes yet',
    'storage.changesWillAppear': 'Changes will appear here when spare parts are used or updated',
    'storage.totalChanges': 'Total Changes',
    // Reports
    'reports.title': 'Reports & Analytics',
    'reports.subtitle': 'View performance metrics and generate reports',
    'reports.totalRequests': 'Total Requests',
    'reports.overdueRequests': 'Overdue Requests',
    'reports.completed': 'Completed',
    'reports.overdue': 'Overdue Requests',
    'reports.onTimePercentage': 'On-time %',
    'reports.avgResolutionHours': 'Avg. resolution (hrs)',
    // Export
    'export.title': 'Export Reports',
    'export.subtitle': 'Download Excel reports for different data sets',
    'export.allRequests': 'Export All Requests',
    'export.overdueRequests': 'Export Overdue Requests',
    'export.byStatus': 'Export by Status',
    'export.byDepartment': 'Export by Department',
    'export.byWarranty': 'Export by Warranty Status',
    'export.dashboardStats': 'Export Dashboard Statistics',
    'export.downloading': 'Downloading...',
    'export.success': 'File downloaded successfully',
    'export.error': 'Failed to download file',
    // Login
    'login.title': 'Sign in to your account',
    'login.subtitle': 'Access the after-sales service management system',
    'login.username': 'Username',
    'login.password': 'Password',
    'login.usernamePlaceholder': 'Enter your username',
    'login.passwordPlaceholder': 'Enter your password',
    'login.signin': 'Sign in',
    'login.signingIn': 'Signing in...',
    'login.fillAllFields': 'Please fill in all fields',
    'login.failed': 'Login failed. Please check your credentials.',
    'login.invalidCredentials': 'Wrong username or password',
    'login.wrongCredentials': 'The username or password you entered is incorrect. Please try again.',
    'login.demoCredentials': 'Demo Credentials:',
    'login.companyManager': 'Company Manager:',
    'login.deputyManager': 'Deputy Manager:',
    'login.lgManager': 'LG Manager:',
    'login.technician': 'Technician:',
    // Common
    'common.loading': 'Loading...',
    'common.error': 'Error',
    'common.success': 'Success',
    'common.save': 'Save',
    'common.saving': 'Saving...',
    'common.cancel': 'Cancel',
    'common.submit': 'Submit',
    'common.create': 'Create',
    'common.edit': 'Edit',
    'common.delete': 'Delete',
    'common.update': 'Update',
    'common.close': 'Close',
    'common.open': 'Open',
    'common.add': 'Add',
    'common.view': 'View',
    'common.search': 'Search',
    'common.filter': 'Filter',
    'common.actions': 'Actions',
    'common.status': 'Status',
    'common.name': 'Name',
    'common.email': 'Email',
    'common.phone': 'Phone',
    'common.address': 'Address',
    'common.description': 'Description',
    'common.date': 'Date',
    'common.time': 'Time',
    'common.amount': 'Amount',
    'common.total': 'Total',
    'common.new': 'New',
    'common.yes': 'Yes',
    'common.no': 'No',
    'common.required': 'Required',
    'common.optional': 'Optional',
    'common.select': 'Select',
    'common.selectOption': 'Select an option',
    'common.all': 'All',
    'common.none': 'None',
    'common.back': 'Back',
    'common.next': 'Next',
    'common.previous': 'Previous',
    'common.first': 'First',
    'common.last': 'Last',
    'common.clear': 'Clear',
    'common.by': 'By',
    // Errors
    'error.failedToLoad': 'Failed to load data',
    'error.failedToSave': 'Failed to save data',
    'error.failedToDelete': 'Failed to delete data',
    'error.failedToUpdate': 'Failed to update data',
    'error.failedToCreate': 'Failed to create data',
    'error.networkError': 'Network error',
    'error.serverError': 'Server error',
    'error.unauthorized': 'Unauthorized',
    'error.forbidden': 'Forbidden',
    'error.notFound': 'Not found',
    'error.validation': 'Validation error',
    'error.noPermission': 'No permissions. Please consult your administrator.',
    // App
    'app.name': 'After-Sales',
    'app.subtitle': 'Service Management',
    'app.fullTitle': 'After-Sales Service Management',
    'app.description': 'Internal management system for service and maintenance',
    'app.copyright': '© 2024 After-Sales Service Management System. All rights reserved.',
  },
  ar: {
    'requests.title': 'طلبات الخدمة',
    'requests.subtitle': 'إدارة ومتابعة جميع طلبات الخدمة',
    'requests.new': 'طلب جديد',
    'requests.section.allRequests': 'جميع الطلبات',
    'requests.section.filters': 'البحث والتصفية في طلبات الخدمة',
    'requests.search.label': 'البحث في الطلبات',
    'requests.search.placeholder': 'ابحث برقم الطلب، اسم العميل، أو وصف المشكلة...',
    'requests.search.resetHint': 'اضغط على زر الهروب لإعادة تعيين التصفية أو استخدم مسح النص',
    'requests.filters.status': 'الحالة',
    'requests.filters.status.all': 'جميع الحالات',
    'requests.filters.priority': 'الأولوية',
    'requests.filters.priority.all': 'جميع الأولويات',
    'requests.filters.warranty': 'حالة الكفالة',
    'requests.filters.warranty.all': 'جميع حالات الكفالة',
    'requests.filters.department': 'القسم',
    'requests.filters.department.all': 'جميع الأقسام',
    'requests.filters.technician': 'الفني المختص',
    'requests.filters.technician.all': 'جميع الفنيين',
    'requests.filters.limit': 'عرض',
    'requests.filters.limit.option': '{count} طلبات',
    'requests.filters.overdueOnly': 'الطلبات المتأخرة فقط',
    'requests.summary.total': '{count} طلب إجمالي',
    'requests.summary.overdue': '{count} متأخر',
    'requests.summary.separator': '•',
    'requests.overdue.badge': 'متأخر',
    'requests.table.number': 'رقم الطلب',
    'requests.table.customer': 'العميل',
    'requests.table.department': 'القسم',
    'requests.table.technician': 'الفني',
    'requests.table.status': 'الحالة',
    'requests.table.priority': 'الأولوية',
    'requests.table.created': 'تاريخ الإنشاء',
    'requests.table.view': 'عرض',
    'requests.empty': 'لا توجد طلبات',
    'requests.loading': 'جاري التحميل...',
    'create.title': 'إنشاء طلب جديد',
    'create.subtitle': 'إنشاء طلب صيانة جديد لعميل',
    'create.cardTitle': 'معلومات الطلب',
    'create.cardSubtitle': 'يرجى ملء جميع الحقول المطلوبة',
    'create.customer': 'العميل',
    'create.customerPlaceholder': 'اختر العميل...',
    'create.product': 'المنتج (اختياري)',
    'create.productPlaceholder': 'اختر المنتج (اختياري)...',
    'create.executionMethod': 'طريقة التنفيذ',
    'create.executionOnsite': 'زيارة موقعية',
    'create.executionWorkshop': 'ورشة',
    'create.warrantyStatus': 'حالة الكفالة',
    'create.warrantyUnder': 'ضمن الكفالة',
    'create.warrantyOut': 'خارج الكفالة',
    'create.priority': 'الأولوية',
    'create.priorityLow': 'منخفضة',
    'create.priorityNormal': 'عادية',
    'create.priorityHigh': 'عالية',
    'create.priorityUrgent': 'عاجلة',
    'create.purchaseDate': 'تاريخ الشراء (اختياري)',
    'create.purchaseDateHelp': 'تاريخ شراء المنتج (اختياري)',
    'create.issue': 'وصف المشكلة',
    'create.issue.placeholder': 'صف المشكلة...',
    'create.issueHelp': 'قدم معلومات مفصلة عن المشكلة أو الخدمة المطلوبة',
    'create.submit': 'إنشاء الطلب',
    'create.cancel': 'إلغاء',
    'create.creating': 'جاري الإنشاء...',
    'details.title': 'تفاصيل الطلب',
    'details.subtitle': 'عرض وإدارة تفاصيل الطلب',
    'details.back': 'رجوع',
    'details.overview': 'نظرة عامة',
    'details.number': 'الرقم',
    'details.status': 'الحالة',
    'details.customer': 'العميل',
    'details.department': 'القسم',
    'details.technician': 'الفني',
    'details.priority': 'الأولوية',
    'details.issue': 'المشكلة',
    'details.activities': 'الأنشطة',
    'details.activities.empty': 'لا توجد أنشطة بعد.',
    'details.costs': 'التكاليف',
    'details.costs.add': 'إضافة',
    'details.assign': 'تعيين فني',
    'details.updateStatus': 'تحديث الحالة',
    'details.close': 'إغلاق الطلب',
    'details.finalNotes': 'ملاحظات ختامية',
    'details.satisfaction': 'رضا العميل (1-5)',
    'pagination.prev': 'السابق',
    'pagination.next': 'التالي',
    'pagination.pageOf': 'الصفحة {page} من {totalPages} • {total} إجمالي',
    // Navigation
    'nav.dashboard': 'لوحة التحكم',
    'nav.requests': 'الطلبات',
    'nav.customers': 'العملاء',
    'nav.products': 'المنتجات',
    'nav.storage': 'المخزن',
    'nav.warehouse': 'المستودع',
    'nav.users': 'المستخدمين',
    'nav.accounts': 'الحسابات',
    'nav.statusManagement': 'إدارة الحالات',
    'status.title': 'إدارة الحالات',
    'status.subtitle': 'إدارة حالات الطلبات المخصصة',
    'status.add': 'إضافة حالة',
    'status.edit': 'تعديل الحالة',
    'status.delete': 'حذف الحالة',
    'status.name': 'اسم الحالة',
    'status.displayName': 'الاسم المعروض',
    'status.description': 'الوصف',
    'status.color': 'اللون',
    'status.isActive': 'نشط',
    'status.sortOrder': 'ترتيب العرض',
    'status.createdBy': 'أنشأ بواسطة',
    'status.createdAt': 'تاريخ الإنشاء',
    'status.actions': 'الإجراءات',
    'status.noStatuses': 'لا توجد حالات',
    'status.confirmDelete': 'هل أنت متأكد من حذف هذه الحالة؟',
    'status.success.created': 'تم إنشاء الحالة بنجاح',
    'status.success.updated': 'تم تحديث الحالة بنجاح',
    'status.success.deleted': 'تم حذف الحالة بنجاح',
    'status.error.load': 'فشل في تحميل الحالات',
    'status.error.create': 'فشل في إنشاء الحالة',
    'status.error.update': 'فشل في تحديث الحالة',
    'status.error.delete': 'فشل في حذف الحالة',
    'nav.reports': 'التقارير',
    'dashboard.stats.totalRequests': 'إجمالي الطلبات',
    'dashboard.stats.overdueRequests': 'الطلبات المتأخرة',
    'dashboard.stats.completedRequests': 'المكتملة',
    'dashboard.stats.pendingRequests': 'الطلبات المعلقة',
    'dashboard.stats.underWarranty': 'ضمن الكفالة',
    'dashboard.stats.outOfWarranty': 'خارج الكفالة',
    'dashboard.welcome': 'مرحباً بك، {firstName}!',
    'dashboard.welcomeSubtitle': 'إليك ما يحدث مع طلبات الصيانة اليوم.',
    'dashboard.overdueAlert': 'تنبيه: لديك {count} طلب متأخر',
    'dashboard.overdueDescription': 'الطلبات التالية تجاوزت المدة المحددة وتحتاج إلى اهتمام فوري:',
    'dashboard.daysOverdue': 'أيام تأخير',
    'dashboard.viewAllOverdue': 'عرض جميع الطلبات المتأخرة ({count})',
    'dashboard.recentRequests': 'الطلبات الحديثة',
    'dashboard.recentRequestsDesc': 'أحدث طلبات الصيانة في النظام',
    'dashboard.loading': 'جاري التحميل...',
    'dashboard.noRequests': 'لا توجد طلبات',
    'dashboard.showingRequests': 'عرض {count} من {total} طلب',
    'dashboard.viewAllRequests': 'عرض جميع الطلبات ←',
    'dashboard.quickActions.newRequest': 'طلب جديد',
    'dashboard.quickActions.newRequestDesc': 'إنشاء طلب صيانة جديد',
    'dashboard.quickActions.clients': 'إدارة العملاء',
    'dashboard.quickActions.clientsDesc': 'عرض وإدارة العملاء',
    'dashboard.quickActions.reports': 'التقارير',
    'dashboard.quickActions.reportsDesc': 'عرض التحليلات والتقارير',
    'dashboard.quickActions.profile': 'الملف الشخصي',
    'dashboard.quickActions.profileDesc': 'تحديث إعدادات الملف الشخصي',
    'dashboard.table.number': 'رقم الطلب',
    'dashboard.table.client': 'العميل',
    'dashboard.table.product': 'المنتج',
    'dashboard.table.status': 'الحالة',
    'dashboard.table.priority': 'الأولوية',
    'dashboard.table.created': 'تاريخ الإنشاء',
    'dashboard.undefined': 'غير محدد',
    // Customers
    'customers.title': 'العملاء',
    'customers.subtitle': 'إدارة معلومات العملاء',
    'customers.add': 'إضافة عميل',
    'customers.name': 'الاسم',
    'customers.phone': 'الهاتف',
    'customers.email': 'البريد الإلكتروني',
    'customers.city': 'المدينة',
    'customers.address': 'العنوان',
    'customers.loading': 'جاري تحميل العملاء...',
    'customers.empty': 'لا يوجد عملاء',
    'customers.save': 'حفظ',
    'customers.cancel': 'إلغاء',
    // Products
    'products.title': 'المنتجات',
    'products.subtitle': 'إدارة كتالوج المنتجات',
    'products.add': 'إضافة منتج',
    'products.name': 'الاسم',
    'products.model': 'الموديل',
    'products.serial': 'الرقم التسلسلي',
    'products.category': 'التصنيف',
    'products.department': 'القسم',
    'products.warranty': 'الضمان (أشهر)',
    'products.loading': 'جاري تحميل المنتجات...',
    'products.empty': 'لا يوجد منتجات',
    'products.save': 'حفظ',
    'products.cancel': 'إلغاء',
    'products.readOnlyAccess': 'لديك صلاحية عرض المنتجات فقط',
    // Storage
    'storage.title': 'إدارة المخزن',
    'storage.subtitle': 'إدارة قطع الغيار والمخزون',
    // Warehouse
    'warehouse.title': 'المستودع',
    'warehouse.subtitle': 'إدارة قطع الغيار والطلبات المرتبطة',
    'warehouse.onlyKeeper': 'فقط أمين المستودع يمكنه التعديل',
    'storage.add': 'إضافة قطعة غيار',
    'storage.name': 'اسم القطعة',
    'storage.partNumber': 'رقم القطعة',
    'storage.presentPieces': 'عدد القطع الموجودة',
    'storage.category': 'التصنيف',
    'storage.currency': 'العملة',
    'storage.quantity': 'الكمية',
    'storage.minQuantity': 'الحد الأدنى',
    'storage.unitPrice': 'سعر الوحدة',
    'storage.supplier': 'المورد',
    'storage.location': 'الموقع',
    'storage.description': 'الوصف',
    'storage.loading': 'جاري تحميل قطع الغيار...',
    'storage.empty': 'لا توجد قطع غيار',
    'storage.save': 'حفظ',
    'storage.cancel': 'إلغاء',
    'storage.edit': 'تعديل',
    'storage.delete': 'حذف',
    'storage.update': 'تحديث',
    'storage.addToRequest': 'إضافة للطلب',
    'storage.quantityUsed': 'الكمية المستخدمة',
    'storage.totalCost': 'التكلفة الإجمالية',
    'storage.inStock': 'متوفر',
    'storage.lowStock': 'كمية قليلة',
    'storage.outOfStock': 'نفد المخزون',
    'storage.stockStatus': 'حالة المخزون',
    'storage.lastUpdated': 'آخر تحديث',
    'storage.actions': 'الإجراءات',
    'storage.confirmDelete': 'هل أنت متأكد من حذف هذه القطعة؟',
    'storage.deleteSuccess': 'تم حذف القطعة بنجاح',
    'storage.createSuccess': 'تم إنشاء القطعة بنجاح',
    'storage.updateSuccess': 'تم تحديث القطعة بنجاح',
    'storage.addToRequestSuccess': 'تم إضافة القطعة للطلب بنجاح',
    'storage.history': 'التاريخ',
    'storage.changeHistory': 'تاريخ التغييرات',
    'storage.changeReason': 'سبب التعديل (مطلوب)',
    'storage.changeReasonPlaceholder': 'يرجى توضيح سبب التعديل (مثلاً: تحديث السعر بسبب تغير سعر الموّرد، تصحيح الكمية بعد الجرد...)',
    'storage.changeReasonHelp': 'سيتم حفظ هذا السبب في التغييرات ليراه المديرون',
    'storage.loadingHistory': 'جاري التحميل...',
    'storage.noChanges': 'لا توجد تغييرات',
    'storage.noChangesYet': 'لا توجد تغييرات حتى الآن',
    'storage.changesWillAppear': 'سيتم عرض التغييرات هنا عند استخدام أو تحديث قطع الغيار',
    'storage.totalChanges': 'إجمالي التغييرات',
    // Users
    'users.title': 'المستخدمون',
    'users.subtitle': 'إدارة المستخدمين والصلاحيات',
    'users.list.title': 'مستخدمو النظام',
    'users.add': 'إضافة مستخدم',
    'users.active': 'نشط',
    'users.inactive': 'غير نشط',
    'users.deactivate': 'تعطيل',
    'users.activate': 'تفعيل',
    'users.noUsersFound': 'لا يوجد مستخدمين',
    'users.noUsersFoundDescription': 'لم يتم العثور على مستخدمين حسب المعايير المحددة. حاول تعديل الفلاتر أو أضف مستخدماً جديداً.',
    'users.addUser': 'إضافة مستخدم جديد',
    'users.list.subtitle': 'عرض وإدارة جميع مستخدمي النظام',
    'users.list.totalUsers': 'إجمالي المستخدمين',
    'users.filters.role': 'الدور',
    'users.filters.allRoles': 'جميع الأدوار',
    'users.filters.department': 'القسم',
    'users.filters.allDepartments': 'جميع الأقسام',
    'users.filters.status': 'الحالة',
    'users.filters.allStatus': 'جميع الحالات',
    'users.filters.active': 'نشط',
    'users.filters.inactive': 'غير نشط',
    'users.table.name': 'الاسم',
    'users.table.username': 'اسم المستخدم',
    'users.table.email': 'البريد الإلكتروني',
    'users.table.role': 'الدور',
    'users.table.department': 'القسم',
    'users.table.status': 'الحالة',
    'users.table.actions': 'الإجراءات',
    'users.roles.companyManager': 'مدير الشركة',
    'users.roles.deputyManager': 'نائب المدير',
    'users.roles.departmentManager': 'مدير قسم',
    'users.roles.sectionSupervisor': 'مشرف قسم',
    'users.roles.technician': 'فني',
    'users.roles.warehouseKeeper': 'أمين المستودع',
    'users.loading': 'جاري تحميل المستخدمين...',
    'users.empty': 'لا يوجد مستخدمين',
    'users.editUser': 'تعديل المستخدم',
    'users.userInformation': 'معلومات المستخدم',
    'users.firstName': 'الاسم الأول',
    'users.lastName': 'الاسم الأخير',
    'users.email': 'البريد الإلكتروني',
    'users.phone': 'الهاتف',
    'users.role': 'الدور',
    'users.department': 'القسم',
    'users.selectDepartment': 'اختر القسم',
    // Reports
    'reports.title': 'التقارير والتحليلات',
    'reports.subtitle': 'عرض مؤشرات الأداء وإنشاء التقارير',
    'reports.totalRequests': 'إجمالي الطلبات',
    'reports.overdueRequests': 'الطلبات المتأخرة',
    'reports.completed': 'المكتملة',
    'reports.overdue': 'الطلبات المتأخرة',
    'reports.onTimePercentage': 'نسبة في الوقت',
    'reports.avgResolutionHours': 'متوسط الحل (ساعات)',
    // Export
    'export.title': 'تصدير التقارير',
    'export.subtitle': 'تحميل تقارير Excel لمجموعات البيانات المختلفة',
    'export.allRequests': 'تصدير جميع الطلبات',
    'export.overdueRequests': 'تصدير الطلبات المتأخرة',
    'export.byStatus': 'تصدير حسب الحالة',
    'export.byDepartment': 'تصدير حسب القسم',
    'export.byWarranty': 'تصدير حسب حالة الكفالة',
    'export.dashboardStats': 'تصدير إحصائيات لوحة التحكم',
    'export.downloading': 'جاري التحميل...',
    'export.success': 'تم تحميل الملف بنجاح',
    'export.error': 'فشل في تحميل الملف',
    // Login
    'login.title': 'تسجيل الدخول إلى حسابك',
    'login.subtitle': 'الوصول إلى نظام إدارة خدمات ما بعد البيع',
    'login.username': 'اسم المستخدم',
    'login.password': 'كلمة المرور',
    'login.usernamePlaceholder': 'أدخل اسم المستخدم',
    'login.passwordPlaceholder': 'أدخل كلمة المرور',
    'login.signin': 'تسجيل الدخول',
    'login.signingIn': 'جاري تسجيل الدخول...',
    'login.fillAllFields': 'يرجى ملء جميع الحقول',
    'login.failed': 'فشل تسجيل الدخول. يرجى التحقق من بيانات الاعتماد.',
    'login.invalidCredentials': 'اسم المستخدم أو كلمة المرور غير صحيحة',
    'login.wrongCredentials': 'اسم المستخدم أو كلمة المرور الذي أدخلته غير صحيح. يرجى المحاولة مرة أخرى.',
    'login.demoCredentials': 'بيانات اعتماد تجريبية:',
    'login.companyManager': 'مدير الشركة:',
    'login.deputyManager': 'نائب المدير:',
    'login.lgManager': 'مدير LG:',
    'login.technician': 'فني:',
    // Common
    'common.loading': 'جاري التحميل...',
    'common.error': 'خطأ',
    'common.success': 'نجح',
    'common.save': 'حفظ',
    'common.saving': 'جاري الحفظ...',
    'common.cancel': 'إلغاء',
    'common.submit': 'إرسال',
    'common.create': 'إنشاء',
    'common.edit': 'تعديل',
    'common.delete': 'حذف',
    'common.update': 'تحديث',
    'common.close': 'إغلاق',
    'common.open': 'فتح',
    'common.add': 'إضافة',
    'common.view': 'عرض',
    'common.search': 'بحث',
    'common.filter': 'تصفية',
    'common.actions': 'الإجراءات',
    'common.status': 'الحالة',
    'common.name': 'الاسم',
    'common.email': 'البريد الإلكتروني',
    'common.phone': 'الهاتف',
    'common.address': 'العنوان',
    'common.description': 'الوصف',
    'common.date': 'التاريخ',
    'common.time': 'الوقت',
    'common.amount': 'المبلغ',
    'common.total': 'الإجمالي',
    'common.new': 'جديد',
    'common.yes': 'نعم',
    'common.no': 'لا',
    'common.required': 'مطلوب',
    'common.optional': 'اختياري',
    'common.select': 'اختر',
    'common.selectOption': 'اختر خيار',
    'common.all': 'الكل',
    'common.none': 'لا شيء',
    'common.back': 'رجوع',
    'common.next': 'التالي',
    'common.previous': 'السابق',
    'common.first': 'الأول',
    'common.last': 'الأخير',
    'common.clear': 'مسح',
    'common.by': 'بواسطة',
    // Errors
    'error.failedToLoad': 'فشل في تحميل البيانات',
    'error.failedToSave': 'فشل في حفظ البيانات',
    'error.failedToDelete': 'فشل في حذف البيانات',
    'error.failedToUpdate': 'فشل في تحديث البيانات',
    'error.failedToCreate': 'فشل في إنشاء البيانات',
    'error.networkError': 'خطأ في الشبكة',
    'error.serverError': 'خطأ في الخادم',
    'error.unauthorized': 'غير مصرح',
    'error.forbidden': 'ممنوع',
    'error.notFound': 'غير موجود',
    'error.validation': 'خطأ في التحقق',
    'error.noPermission': 'لا توجد صلاحيات. يرجى استشارة مدير النظام.',
    // App
    'app.name': 'ما بعد البيع',
    'app.subtitle': 'إدارة الخدمات',
    'app.fullTitle': 'إدارة خدمات ما بعد البيع',
    'app.description': 'نظام إدارة داخلي للخدمة والصيانة',
    'app.copyright': '© 2024 نظام إدارة خدمات ما بعد البيع. جميع الحقوق محفوظة.',
  },
};

type I18nContextType = {
  lang: Lang;
  dir: 'ltr' | 'rtl';
  t: (key: string, vars?: Record<string, string | number>) => string;
  setLang: (lang: Lang) => void;
};

const I18nContext = createContext<I18nContextType | undefined>(undefined);

function getInitialLang(): Lang {
  try {
    const saved = localStorage.getItem('lang');
    if (saved === 'ar' || saved === 'en') return saved;
  } catch {}
  return (navigator.language || 'en').toLowerCase().startsWith('ar') ? 'ar' : 'en';
}

export const I18nProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const [lang, setLangState] = useState<Lang>(getInitialLang());

  useEffect(() => {
    document.documentElement.lang = lang;
    document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
    try { localStorage.setItem('lang', lang); } catch {}
  }, [lang]);

  const t = useMemo(() => (key: string, vars?: Record<string, string | number>) => {
    const dict = translations[lang] || translations.en;
    let value = dict[key] || translations.en[key] || key;
    if (vars) {
      Object.keys(vars).forEach(k => {
        value = value.replace(`{${k}}`, String(vars[k]));
      });
    }
    return value;
  }, [lang]);

  const setLang = (l: Lang) => setLangState(l);

  const dir = useMemo((): 'ltr' | 'rtl' => lang === 'ar' ? 'rtl' : 'ltr', [lang]);

  const value = useMemo(() => ({ lang, dir, t, setLang }), [lang, dir, t]);

  return (
    <I18nContext.Provider value={value}>
      {children}
    </I18nContext.Provider>
  );
};

export const useI18n = (): I18nContextType => {
  const ctx = useContext(I18nContext);
  if (!ctx) throw new Error('useI18n must be used within I18nProvider');
  return ctx;
};


